<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
		
		<title>Mariage</title>
		
		<link rel="stylesheet" href="ressources/jquery-ui-1.11.4.custom/jquery-ui.min.css" />
		<link rel="stylesheet" href="ressources/bootstrap-3.3.6-dist/css/bootstrap.min.css" />
		<link rel="stylesheet" href="ressources/bootstrap-datetimepicker-master/bootstrap-datetimepicker.min.css"/>
		<link rel="stylesheet" href="ressources/jqwidgets-ver4.1.1/jqx.base.css" />
		<link rel="stylesheet" href="ressources/custom.css" />
	</head>
	<body>
		<div class="container-fluid">

			<!-- Colonne gauche -->
			<div class="header col-md-3">
				<div data-w3-include-html="./part_menu.html"></div> 
			</div>
			
			<div class="content col-md-9">

				<div data-w3-include-html="./part_infoMariage.html"></div>
				<script type="text/javascript" src="./part_infoMariage.js"></script>
				
				<div id="utilisateurs"></div>

				<button id="button_afficher_popup_ajouter_utilisateur" class="btn btn-default">Ajouter</button>
				
				<div id="popupAjoutUtilisateur" class="popup">
					<div>Ajout d'un utilisateur</div>
					<div class="form-inline">
						<form>
							<div class="form-group">
								<label for="login">Login</label>
								<input type="text" class="form-control" id="login" name="login" placeholder="Login" required data-minLength="6"/>
							</div>
							<div class="form-group">
								<label for="mdp">Mot de passe</label>
								<input type="password" class="form-control" id="mdp" name="mdp"  placeholder="Mot de passe" required data-minLength="6"/>
							</div>
							<br/><button id="button_ajouter_utilisateur" class="btn btn-default">Ajouter</button>
						</form>
					</div>
				</div>
				
			</div>
		</div>

		<script type="text/javascript" src="ressources/w3-include-HTML.js"></script> 
		<script type="text/javascript" src="ressources/jquery-ui-1.11.4.custom/external/jquery/jquery.js"></script>
		<script type="text/javascript" src="ressources/jquery-ui-1.11.4.custom/jquery-ui.min.js"></script>
		<script type="text/javascript" src="ressources/bootstrap-datetimepicker-master/bootstrap-datetimepicker.min.js"></script>
		<script type="text/javascript" src="ressources/bootstrap-datetimepicker-master/locales/bootstrap-datetimepicker.fr.js"></script>
		<script type="text/javascript" src="ressources/jqwidgets-ver4.1.1/jqxcore.js"></script>
		<script type="text/javascript" src="ressources/jqwidgets-ver4.1.1/jqxbuttons.js"></script>
		<script type="text/javascript" src="ressources/jqwidgets-ver4.1.1/jqxscrollbar.js"></script>
		<script type="text/javascript" src="ressources/jqwidgets-ver4.1.1/jqxmenu.js"></script>
		<script type="text/javascript" src="ressources/jqwidgets-ver4.1.1/jqxgrid.js"></script>
		<script type="text/javascript" src="ressources/jqwidgets-ver4.1.1/jqxgrid.edit.js"></script>
		<script type="text/javascript" src="ressources/jqwidgets-ver4.1.1/jqxgrid.selection.js"></script>
		<script type="text/javascript" src="ressources/jqwidgets-ver4.1.1/jqxgrid.columnsresize.js"></script>
		<script type="text/javascript" src="ressources/jqwidgets-ver4.1.1/jqxgrid.filter.js"></script>
		<script type="text/javascript" src="ressources/jqwidgets-ver4.1.1/jqxgrid.sort.js"></script>
		<script type="text/javascript" src="ressources/jqwidgets-ver4.1.1/jqxdata.js"></script> 
		<script type="text/javascript" src="ressources/jqwidgets-ver4.1.1/jqxscrollbar.js"></script>
		<script type="text/javascript" src="ressources/jqwidgets-ver4.1.1/jqxdropdownlist.js"></script>
		<script type="text/javascript" src="ressources/jqwidgets-ver4.1.1/jqxlistbox.js"></script>
		<script type="text/javascript" src="ressources/jqwidgets-ver4.1.1/jqxwindow.js"></script>
		<script type="text/javascript" src="ressources/common.js"></script>
		<script type="text/javascript">
		var donneesDejaChargees = false;

		// Affiche la popup
		var affichePopupUtilisateur = function() { $("#popupAjoutUtilisateur").jqxWindow('open'); };

		// Sauvegarde utilisateur par un POST
		var ajouteUtilisateur = function(e) {
			e.preventDefault();
			
			valideForm("#popupAjoutUtilisateur form", function(data) {
				var req = $.ajax({ type: "POST", url: REST_PREFIX + "/utilisateur", data: data});
				req.success(function(dataString) {
					$("#popupAjoutUtilisateur").jqxWindow("close");
					chargeUtilisateurs();
				});
				req.fail(function(jqXHR, textStatus, errorThrown) {ajaxFailFunctionToDisplayWarn("ajouteUtilisateur");});
			});
		};

		var supprimeUtilisateur = function(id) {
			var req = $.ajax({ type: "DELETE", url: REST_PREFIX + "/utilisateur/" + id});
			req.success(function(dataString) { chargeUtilisateurs(); });
			req.fail(function(jqXHR, textStatus, errorThrown) {ajaxFailFunctionToDisplayWarn("supprimeUtilisateur");});
		};
		
		// Chargement des utilisateurs
		var chargeUtilisateurs = function() {
			if (donneesDejaChargees) {
				$("#utilisateurs").jqxGrid('updatebounddata', 'cells');
			} else {
				var dataAdapter = new $.jqx.dataAdapter({
					datatype: "json",
					url: REST_PREFIX + "/utilisateur",
					datafields: [{ name: 'login', type: 'string' },{ name: 'id', type: 'string' }],
					id: 'login'
				});
				var rendererColonneBouton = function (rowIndex, columnfield, value, defaulthtml, columnproperties) { return "<a href='javascript:supprimeUtilisateur(\"" + value + "\")' id='btn" + value + "'><span class='ui-icon ui-icon-trash'></span></a>" };
				$("#utilisateurs").jqxGrid({
					source: dataAdapter,
					columns: [
						{ text: 'Login', datafield: 'login', width: "80%" },
						{ text: 'Actions', datafield: 'id', width: "20%", editable: false, sortable: false, menu: false, cellsrenderer: rendererColonneBouton }
					],
					sortable: true,
					filterable: true,
					autoheight: true,
					width: 950
				});
				donneesDejaChargees = true;
			}
		};

		
			$(document).ready(function() {
				
				// Init
				chargeUtilisateurs();
				
				// Ajout des evenements
				$("#button_afficher_popup_ajouter_utilisateur").on("click", affichePopupUtilisateur);
				$("#button_ajouter_utilisateur").on("click", ajouteUtilisateur);

			});
		</script>
	</body>
</html>